!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.Mars||(t.Mars={})).Meteor=e()}}(function(){return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var n=t[s][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){var t=_["default"].defaultDelegate(),n=function(t){function n(){var t;i(this,n);for(var r=arguments.length,s=Array(r),a=0;r>a;a++)s[a]=arguments[a];var u=o(this,(t=Object.getPrototypeOf(n)).call.apply(t,[this].concat(s)));return e.on("status:connected",(0,l["default"])(u._handleConnected,u)),e.on("message:added",(0,l["default"])(u._handleRemoteAdded,u)),e.on("message:changed",(0,l["default"])(u._handleRemoteChanged,u)),e.on("message:removed",(0,l["default"])(u._handleRemoteRemoved,u)),u}return s(n,t),u(n,[{key:"insert",value:function(t){var r=this,i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=c(Object.getPrototypeOf(n.prototype),"insert",this).call(this,t,i,o);if(!i.quiet){var a="/"+this.db.modelName+"/insert",u=function(e){return s.then(function(){return r.db.remove(t._id,{quiet:!0})}).then(function(){throw e})};e.methodManager.apply(a,[t,i],o.seed).result().then(null,u)}return s}},{key:"remove",value:function(t){var r=this,i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=c(Object.getPrototypeOf(n.prototype),"remove",this).call(this,t,i);if(!i.quiet){var s="/"+this.db.modelName+"/remove",a=function(e){return o.then(function(e){return r.db.insertAll(e,{quiet:!0})}).then(function(){throw e})};e.methodManager.apply(s,[t,i]).result().then(null,a)}return o}},{key:"update",value:function(t,r){var i=this,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=c(Object.getPrototypeOf(n.prototype),"update",this).call(this,t,r,o);if(!o.quiet){var a="/"+this.db.modelName+"/update",u=function(e){return s.then(function(e){e.inserted?i.db.remove(e.inserted._id,{quiet:!0}):(0,d["default"])(e.original,function(e){var t=e._id;delete e._id,i.db.update({_id:t},e,{quiet:!0,upsert:!0})})}).then(function(){throw e})};e.methodManager.apply(a,[t,r,o]).result().then(null,u)}return s}},{key:"_handleRemoteAdded",value:function(e){return delete e.fields._id,this.db.update({_id:e.id},e.fields,{quiet:!0,upsert:!0})}},{key:"_handleRemoteChanged",value:function(e){var t={};if(Array.isArray(e.cleared)&&e.cleared.length>0){t.$unset={};var n=!0,r=!1,i=void 0;try{for(var o,s=e.cleared[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;t.$unset[a]=1}}catch(u){r=!0,i=u}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw i}}}return e.fields&&(delete e.fields._id,t.$set={},(0,d["default"])(e.fields,function(e,n){t.$set[n]=e})),(0,y["default"])(t).length>0?this.db.update(e.id,t,{quiet:!0}):void 0}},{key:"_handleRemoteRemoved",value:function(e){return this.db.remove(e.id,{quiet:!0})}},{key:"_handleConnected",value:function(e){}}]),n}(t);return n}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function m(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:m(i,t,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)};Object.defineProperty(n,"__esModule",{value:!0}),n.createCollectionDelegate=a;var f=e("fast.js/function/bind"),l=r(f),h=e("fast.js/forEach"),d=r(h),p=e("fast.js/object/keys"),y=r(p),v=e("marsdb"),_=r(v)},{"fast.js/forEach":14,"fast.js/function/bind":17,"fast.js/object/keys":22,marsdb:void 0}],2:[function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){var t=f.Collection.defaultCursor(),n=function(t){function n(){var e;i(this,n);for(var t=arguments.length,r=Array(t),s=0;t>s;s++)r[s]=arguments[s];return o(this,(e=Object.getPrototypeOf(n)).call.apply(e,[this].concat(r)))}return s(n,t),u(n,[{key:"_doUpdate",value:function(){for(var t=this,i=arguments.length,o=Array(i),s=0;i>s;s++)o[s]=arguments[s];var a=this.options.sub;if(!this._subscription&&a){var u;return this._subscription=(u=e.subManager).subscribe.apply(u,r(a)),this.once("observeStopped",function(){t._subscription.stop(),delete t._subscription}),this._subscription.ready().then(function(){var e;return(e=c(Object.getPrototypeOf(n.prototype),"_doUpdate",t)).call.apply(e,[t].concat(o))})}var f;return(f=c(Object.getPrototypeOf(n.prototype),"_doUpdate",this)).call.apply(f,[this].concat(o))}}]),n}(t);return n}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function l(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:l(i,t,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)};Object.defineProperty(n,"__esModule",{value:!0}),n.createCursorWithSub=a;var f=e("marsdb")},{marsdb:void 0}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var u=e("fast.js/function/try"),c=r(u),f=e("fast.js/function/bind"),l=r(f),h=e("marsdb"),d=e("marsdb/dist/PromiseQueue"),p=r(d),y=e("marsdb/dist/AsyncEventEmitter"),v=r(y),_=e("marsdb-sync-server/dist/HeartbeatManager"),m=r(_),g=1,b=5e3,P={CONNECTING:"CONNECTING",CONNECTED:"CONNECTED",DISCONNECTED:"DISCONNECTED"},O=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?WebSocket:arguments[1];i(this,t);var r=o(this,Object.getPrototypeOf(t).call(this));return r.endPoint=e,r._queue=new p["default"](1),r._fullyConnectedOnce=!1,r._sessionId=null,r._socket=n,r._heartbeat=new m["default"],r._heartbeat.on("timeout",(0,l["default"])(r._handleHearbeatTimeout,r)),r._heartbeat.on("sendPing",(0,l["default"])(r.sendPing,r)),r._heartbeat.on("sendPong",(0,l["default"])(r.sendPong,r)),r.connect(),r}return s(t,e),a(t,[{key:"sendMethod",value:function(e,t,n,r){var i={msg:"method",id:n,method:e,params:t};r&&(i.randomSeed=r),this._sendMessage(i)}},{key:"sendSub",value:function(e,t,n){this._sendMessage({msg:"sub",id:n,name:e,params:t})}},{key:"sendUnsub",value:function(e){this._sendMessage({msg:"unsub",id:e})}},{key:"sendPing",value:function(){this._sendMessage({msg:"ping",id:h.Random["default"]().id(20)})}},{key:"sendPong",value:function(e){this._sendMessage({msg:"pong",id:e})}},{key:"connect",value:function(){this.isConnected||(this._rawConn=new this._socket(this.endPoint),this._rawConn.onopen=(0,l["default"])(this._handleOpen,this),this._rawConn.onerror=(0,l["default"])(this._handleError,this),this._rawConn.onclose=(0,l["default"])(this._handleClose,this),this._rawConn.onmessage=(0,l["default"])(this._handleRawMessage,this),this._setStatus(P.CONNECTING))}},{key:"reconnect",value:function(){clearTimeout(this._reconnTimer),this._reconnecting=!0,this._setStatus(P.DISCONNECTED),this._reconnTimer=setTimeout((0,l["default"])(this.connect,this),b)}},{key:"_handleOpen",value:function(){this._heartbeat.waitPing(),this._sendMessage({msg:"connect",session:this._sessionId,version:g,support:[g]})}},{key:"_handleConnectedMessage",value:function(e){this.isConnected||(this._setStatus(P.CONNECTED,this._reconnecting),this._sessionId=e.session,this._fullyConnectedOnce=!0,this._reconnecting=!1)}},{key:"_handleClose",value:function(){this._heartbeat._clearTimers(),this.reconnect()}},{key:"_handleHearbeatTimeout",value:function(){this._rawConn.close()}},{key:"_handleError",value:function(e){this.emit("error",e)}},{key:"_handleRawMessage",value:function(e){var t=this;return this._queue.add(function(){var n=(0,c["default"])(function(){var n=h.EJSON.parse(e.data);return t._processMessage(n)});return n instanceof Error?t._handleError(n):n})}},{key:"_processMessage",value:function(e){switch(e.msg){case"conected":return this._handleConnectedMessage(e);case"ping":return this._heartbeat.handlePing(e);case"pong":return this._heartbeat.handlePong(e);case"removed":case"changed":case"added":case"updated":case"result":case"nosub":case"ready":case"error":return this.emitAsync("message:"+e.msg,e);default:throw new Error("Unknown message type "+e.msg)}}},{key:"_sendMessage",value:function(e){var t=this,n=(0,c["default"])(function(){return t._rawConn.send(h.EJSON.stringify(e))});n instanceof Error&&this._handleError(n)}},{key:"_setStatus",value:function(e,t,n,r){this._status=e,console.log(this._status),this.emit(("status:"+e).toLowerCase(),t,n,r)}},{key:"isConnected",get:function(){return this._status===P.CONNECTED}}]),t}(v["default"]);n["default"]=O},{"fast.js/function/bind":17,"fast.js/function/try":19,marsdb:void 0,"marsdb-sync-server/dist/HeartbeatManager":25,"marsdb/dist/AsyncEventEmitter":26,"marsdb/dist/PromiseQueue":27}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("marsdb"),u=function(e){function t(e,n,o,s){r(this,t);var u=i(this,Object.getPrototypeOf(t).call(this));return u.result=function(){return u._promiseMixed(new Promise(function(e,t){u._error?t(u._error):u._result?e(u._result):(u.once("result",e),u.once("error",t))}))},u.updated=function(){return u._promiseMixed(new Promise(function(e,t){u._updated?e():u.once("updated",e)}))},u.id=a.Random["default"]().id(20),s.sendMethod(e,n,u.id,o),u}return o(t,e),s(t,[{key:"_promiseMixed",value:function(e){var t=this;return{result:this.result,updated:this.updated,then:function(){return t._promiseMixed(e.then.apply(e,arguments))}}}},{key:"_handleResultMessage",value:function(e){e.id==this.id&&(e.error?(this._error=e.error,this.emit("error",e.error)):(this._result=e.result,this.emit("result",e.result)))}},{key:"_handleUpdatedMessage",value:function(e){this._updated=!0,this.emit("updated")}}]),t}(a.EventEmitter);n["default"]=u},{marsdb:void 0}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("fast.js/forEach"),u=r(a),c=e("invariant"),f=r(c),l=e("./MethodCall"),h=r(l),d=function(){function e(t){i(this,e),this.conn=t,this._methods={},t.on("status:disconnected",this._handleDisconnected.bind(this)),t.on("message:result",this._handleMethodResult.bind(this)),t.on("message:updated",this._handleMethodUpdated.bind(this))}return s(e,[{key:"call",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return this.apply(e,n)}},{key:"apply",value:function(e,t,n){var r=this;(0,f["default"])("string"==typeof e,"Method name must be a string, but given type is %s","undefined"==typeof e?"undefined":o(e)),(0,f["default"])(!t||Array.isArray(t),"Params must be an array or undefined, but given type is %s","undefined"==typeof t?"undefined":o(t));var i=new h["default"](e,t,n,this.conn);this._methods[i.id]=i;var s=function(){r._methods[i.id]&&r._methods[i.id]._result&&r._methods[i.id]._updated&&delete r._methods[i.id]};return i.result().then(s).updated().then(s),i}},{key:"_handleMethodResult",value:function(e){e.id&&this._methods[e.id]&&this._methods[e.id]._handleResultMessage(e)}},{key:"_handleMethodUpdated",value:function(e){var t=this;(0,u["default"])(e.methods,function(n){t._methods[n]&&t._methods[n]._handleUpdatedMessage(e)})}},{key:"_handleDisconnected",value:function(){(0,u["default"])(this._methods,function(e){e._handleResultMessage({error:new Error("Disconnected, method can't be done")})}),this._methods={}}}]),e}();n["default"]=d},{"./MethodCall":4,"fast.js/forEach":14,invariant:24}],6:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.SUB_STATUS=void 0;var a=e("marsdb"),u=n.SUB_STATUS={READY_PENDING:"READY_PENDING",READY:"READY",ERROR:"ERROR",STOP_PENDING:"STOP_PENDING",STOPPED:"STOPPED",FROZEN:"FROZEN"},c=function(e){function t(e,n,o){var s=arguments.length<=3||void 0===arguments[3]?15e3:arguments[3];r(this,t);var c=i(this,Object.getPrototypeOf(t).call(this));return c.ready=function(){return c._promiseMixed(new Promise(function(e,t){c.isReady?e():(c.once(u.READY,e),c.once(u.ERROR,t))}))},c.stopped=function(){return c._promiseMixed(new Promise(function(e,t){c.isStopped?e():(c.once(u.STOPPED,e),c.once(u.ERROR,t))}))},c.id=a.Random["default"]().id(20),c.name=e,c.params=n,c._conn=o,c._ready=!1,c._stopWaitTimeout=s,c}return o(t,e),s(t,[{key:"stop",value:function(){this._scheduleStop()}},{key:"_promiseMixed",value:function(e){var t=this;return{stopped:this.stopped,ready:this.ready,then:function(){return t._promiseMixed(e.then.apply(e,arguments))}}}},{key:"_subscribe",value:function(){this.status&&this.status!==u.STOP_PENDING&&this.status!==u.STOPPED&&this.status!==u.ERROR&&this.status!==u.FROZEN||(this.status===u.STOP_PENDING?this._ready?(this._clearStopper(),this._setStatus(u.READY)):this._setStatus(u.READY_PENDING):(this._setStatus(u.READY_PENDING),this._conn.sendSub(this.name,this.params,this.id)))}},{key:"_scheduleStop",value:function(){var e=this;this.status!==u.STOP_PENDING&&this.status!==u.STOPPED&&(this._setStatus(u.STOP_PENDING),this._stopTimer=setTimeout(function(){return e._stopImmediately()},this._stopWaitTimeout))}},{key:"_stopImmediately",value:function(e){this.status!==u.STOPPED&&(this._clearStopper(),this._setStatus(u.STOPPED),this._ready=!1,e&&e.dontSendMsg||this._conn.sendUnsub(this.id))}},{key:"_freeze",value:function(){this.status===u.STOP_PENDING?this._stopImmediately({dontSendMsg:!0}):this.status&&this.status===u.STOPPED||this._setStatus(u.FROZEN)}},{key:"_setStatus",value:function(e,t,n,r,i){this.status=e,this.emit(e,t,n,r,i)}},{key:"_clearStopper",value:function(){clearTimeout(this._stopTimer),this._stopTimer=null}},{key:"_handleNosub",value:function(e){this._clearStopper(),e?this._setStatus(u.ERROR,e):this._stopImmediately({dontSendMsg:!0})}},{key:"_handleReady",value:function(){this.status!==u.STOPPED&&this.status!==u.STOP_PENDING&&(this._ready=!0,this._setStatus(u.READY))}},{key:"isReady",get:function(){return this.status==u.READY||this.status===u.FROZEN&&this._ready}},{key:"isReadyPending",get:function(){return this.status===u.READY_PENDING}},{key:"isStopped",get:function(){return this.status===u.STOPPED}},{key:"isStopPending",get:function(){return this.status===u.STOP_PENDING}},{key:"isFaulted",get:function(){return this.status===u.ERROR}},{key:"isFrozen",get:function(){return this.status==u.FROZEN}}]),t}(a.EventEmitter);n["default"]=c},{marsdb:void 0}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var u=e("fast.js/function/bind"),c=r(u),f=e("fast.js/forEach"),l=r(f),h=e("marsdb"),d=e("./Subscription"),p=r(d),y=15e3,v=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this));return n._subs={},n._loading=new Set,n._conn=e,e.on("status:connected",(0,c["default"])(n._handleConnected,n)),e.on("status:disconnected",(0,c["default"])(n._handleDisconnected,n)),e.on("message:ready",(0,c["default"])(n._handleSubscriptionReady,n)),e.on("message:nosub",(0,c["default"])(n._handleSubscriptionNosub,n)),n}return s(t,e),a(t,[{key:"subscribe",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),i=1;n>i;i++)r[i-1]=arguments[i];var o=new p["default"](e,r,this._conn,y);this._subs[o.id]=o,this._trackLoadingStart(o.id);var s=function(){delete t._subs[o.id],t._trackLoadingReady(o.id)};return o.once(d.SUB_STATUS.STOPPED,s),o.once(d.SUB_STATUS.ERROR,s),this._conn.isConnected?o._subscribe():o._freeze(),o}},{key:"addReadyListener",value:function(e){var t=this;return this.on("ready",e),function(){return t.removeListener("ready",e)}}},{key:"addLoadingListener",value:function(e){var t=this;return this.on("loading",e),function(){return t.removeListener("loading",e)}}},{key:"_handleConnected",value:function(){(0,l["default"])(this._subs,function(e){return e._subscribe()})}},{key:"_handleDisconnected",value:function(){var e=this;(0,l["default"])(this._subs,function(t,n){t._freeze(),t.isFrozen?e._trackLoadingStart(n):e._trackLoadingReady(n)})}},{key:"_handleSubscriptionReady",value:function(e){var t=this;(0,l["default"])(e.subs,function(e){var n=t._subs[e];n&&(n._handleReady(),t._trackLoadingReady(e))})}},{key:"_handleSubscriptionNosub",value:function(e){var t=this._subs[e.id];t&&t._handleNosub(e.error)}},{key:"_trackLoadingStart",value:function(e){var t=this._loading.size;this._loading.add(e),0===t&&this._loading.size>0&&this.emit("loading")}},{key:"_trackLoadingReady",value:function(e){var t=this._loading.size;this._loading["delete"](e),t>0&&0===this._loading.size&&this.emit("ready")}}]),t}(h.EventEmitter);n["default"]=v},{"./Subscription":6,"fast.js/forEach":14,"fast.js/function/bind":17,marsdb:void 0}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(){return w}function o(){var e;(e=w.methodManager).call.apply(e,arguments)}function s(){var e;(e=w.methodManager).apply.apply(e,arguments)}function a(){var e;(e=w.subManager).subscribe.apply(e,arguments)}function u(e){var t=e.url,n=e.managers,r=void 0===n?[]:n,i=e.socket,o=void 0===i?WebSocket:i;return(0,h["default"])(!w,"configure(...): connection already configured"),w=new v["default"](t,o),w.subManager=new m["default"](w),w.methodManager=new b["default"](w),w.customManagers=(0,f["default"])(r,function(e){return new e(w)}),p["default"].defaultDelegate((0,P.createCollectionDelegate)(w)),p["default"].defaultCursor((0,O.createCursorWithSub)(w)),w}Object.defineProperty(n,"__esModule",{value:!0}),n.getConnection=i,n.call=o,n.apply=s,n.subscribe=a,n.configure=u;var c=e("fast.js/map"),f=r(c),l=e("invariant"),h=r(l),d=e("marsdb"),p=r(d),y=e("./DDPConnection"),v=r(y),_=e("./SubscriptionManager"),m=r(_),g=e("./MethodCallManager"),b=r(g),P=e("./CollectionManager"),O=e("./CursorWithSub"),w=null},{"./CollectionManager":1,"./CursorWithSub":2,"./DDPConnection":3,"./MethodCallManager":5,"./SubscriptionManager":7,"fast.js/map":20,invariant:24,marsdb:void 0}],9:[function(e,t,n){const r=e("./dist");t.exports={configure:r.configure,apply:r.apply,call:r.call,subscribe:r.subsctibe}},{"./dist":8}],10:[function(e,t,n){"use strict";function r(e){if(this._capacity=s(e),this._length=0,this._front=0,this._makeCapacity(),a(e)){for(var t=e.length,n=0;t>n;++n)this[n]=e[n];this._length=t}}function i(e,t,n,r,i){for(var o=0;i>o;++o)n[o+r]=e[o+t]}function o(e){return e>>>=0,e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e+1}function s(e){if("number"!=typeof e){if(!a(e))return 16;e=e.length}return o(Math.min(Math.max(16,e),1073741824))}r.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,r=this._capacity,i=0;e>i;++i)t[i]=this[n+i&r-1];return t},r.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var r=this._capacity;if(n+t>r){for(var i=0;t>i;++i){this._checkCapacity(n+1);var o=this._front+n&this._capacity-1;this[o]=arguments[i],n++,this._length=n}return n}for(var o=this._front,i=0;t>i;++i)this[o+n&r-1]=arguments[i],o++;return this._length=n+t,n+t}if(0===t)return n;this._checkCapacity(n+1);var i=this._front+n&this._capacity-1;return this[i]=e,this._length=n+1,n+1},r.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},r.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},r.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){var r=this._capacity;if(t+n>r){for(var i=n-1;i>=0;i--){this._checkCapacity(t+1);var r=this._capacity,o=(this._front-1&r-1^r)-r;this[o]=arguments[i],t++,this._length=t,this._front=o}return t}for(var s=this._front,i=n-1;i>=0;i--){var o=(s-1&r-1^r)-r;this[o]=arguments[i],s=o}return this._front=s,this._length=t+n,t+n}if(0===n)return t;this._checkCapacity(t+1);var r=this._capacity,i=(this._front-1&r-1^r)-r;return this[i]=e,this._length=t+1,this._front=i,t+1},r.prototype.peekBack=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1;return this[t]}},r.prototype.peekFront=function(){return 0!==this._length?this[this._front]:void 0},r.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(0>t&&(t+=n),!(0>t||t>=n))return this[this._front+t&this._capacity-1]}},r.prototype.isEmpty=function(){return 0===this._length},r.prototype.clear=function(){this._length=0,this._front=0,this._makeCapacity()},r.prototype.toString=function(){return this.toArray().toString()},r.prototype.valueOf=r.prototype.toString,r.prototype.removeFront=r.prototype.shift,r.prototype.removeBack=r.prototype.pop,r.prototype.insertFront=r.prototype.unshift,r.prototype.insertBack=r.prototype.push,r.prototype.enqueue=r.prototype.push,r.prototype.dequeue=r.prototype.shift,r.prototype.toJSON=r.prototype.toArray,Object.defineProperty(r.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),r.prototype._makeCapacity=function(){for(var e=this._capacity,t=0;e>t;++t)this[t]=void 0},r.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(s(1.5*this._capacity+16))},r.prototype._resizeTo=function(e){var t=this._front,n=this._capacity,r=new Array(n),o=this._length;if(i(this,0,r,0,n),this._capacity=e,this._makeCapacity(),this._front=0,n>=t+o)i(r,t,this,0,o);else{var s=o-(t+o&n-1);i(r,t,this,0,s),i(r,0,this,s,o-s)}};var a=Array.isArray;t.exports=r},{}],11:[function(e,t,n){"use strict";function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){}var o="function"!=typeof Object.create?"~":!1;i.prototype._events=void 0,i.prototype.listeners=function(e,t){var n=o?o+e:e,r=this._events&&this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,a=new Array(s);s>i;i++)a[i]=r[i].fn;return a},i.prototype.emit=function(e,t,n,r,i,s){var a=o?o+e:e;if(!this._events||!this._events[a])return!1;var u,c,f=this._events[a],l=arguments.length;if("function"==typeof f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,n),!0;case 4:return f.fn.call(f.context,t,n,r),!0;case 5:return f.fn.call(f.context,t,n,r,i),!0;case 6:return f.fn.call(f.context,t,n,r,i,s),!0}for(c=1,u=new Array(l-1);l>c;c++)u[c-1]=arguments[c];f.fn.apply(f.context,u)}else{var h,d=f.length;for(c=0;d>c;c++)switch(f[c].once&&this.removeListener(e,f[c].fn,void 0,!0),l){case 1:f[c].fn.call(f[c].context);break;case 2:f[c].fn.call(f[c].context,t);break;case 3:f[c].fn.call(f[c].context,t,n);break;default:if(!u)for(h=1,u=new Array(l-1);l>h;h++)u[h-1]=arguments[h];f[c].fn.apply(f[c].context,u)}}return!0},i.prototype.on=function(e,t,n){var i=new r(t,n||this),s=o?o+e:e;return this._events||(this._events=o?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.once=function(e,t,n){var i=new r(t,n||this,!0),s=o?o+e:e;return this._events||(this._events=o?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.removeListener=function(e,t,n,r){var i=o?o+e:e;if(!this._events||!this._events[i])return this;var s=this._events[i],a=[];if(t)if(s.fn)(s.fn!==t||r&&!s.once||n&&s.context!==n)&&a.push(s);else for(var u=0,c=s.length;c>u;u++)(s[u].fn!==t||r&&!s[u].once||n&&s[u].context!==n)&&a.push(s[u]);return a.length?this._events[i]=1===a.length?a[0]:a:delete this._events[i],this},i.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[o?o+e:e]:this._events=o?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=o,"undefined"!=typeof t&&(t.exports=i)},{}],12:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var i,o=e.length,s=void 0!==n?r(t,n):t;for(i=0;o>i;i++)s(e[i],i,e)}},{"../function/bindInternal3":18}],13:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var i,o=e.length,s=new Array(o),a=void 0!==n?r(t,n):t;for(i=0;o>i;i++)s[i]=a(e[i],i,e);return s}},{"../function/bindInternal3":18}],14:[function(e,t,n){"use strict";var r=e("./array/forEach"),i=e("./object/forEach");t.exports=function(e,t,n){return e instanceof Array?r(e,t,n):i(e,t,n)}},{"./array/forEach":12,"./object/forEach":21}],15:[function(e,t,n){"use strict";t.exports=function(e,t){switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);case 4:return e(t[0],t[1],t[2],t[3]);case 5:return e(t[0],t[1],t[2],t[3],t[4]);case 6:return e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return e(t[0],t[1],t[2],t[3],t[4],t[5],t[6]);case 8:return e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]);default:return e.apply(void 0,t)}}},{}],16:[function(e,t,n){"use strict";t.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2]);case 4:return e.call(t,n[0],n[1],n[2],n[3]);case 5:return e.call(t,n[0],n[1],n[2],n[3],n[4]);case 6:return e.call(t,n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return e.call(t,n[0],n[1],n[2],n[3],n[4],n[5],n[6]);case 8:return e.call(t,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);default:return e.apply(t,n)}}},{}],17:[function(e,t,n){"use strict";var r=e("./applyWithContext"),i=e("./applyNoContext");t.exports=function(e,t){var n,o=arguments.length-2;if(o>0){n=new Array(o);for(var s=0;o>s;s++)n[s]=arguments[s+2];return void 0!==t?function(){var i,s=arguments.length,a=new Array(o+s);for(i=0;o>i;i++)a[i]=n[i];for(i=0;s>i;i++)a[o+i]=arguments[i];return r(e,t,a)}:function(){var t,r=arguments.length,s=new Array(o+r);for(t=0;o>t;t++)s[t]=n[t];for(t=0;r>t;t++)s[o+t]=arguments[t];return i(e,s)}}return void 0!==t?function(){return r(e,t,arguments)}:function(){return i(e,arguments)}}},{"./applyNoContext":15,"./applyWithContext":16}],18:[function(e,t,n){"use strict";t.exports=function(e,t){
return function(n,r,i){return e.call(t,n,r,i)}}},{}],19:[function(e,t,n){"use strict";t.exports=function(e){try{return e()}catch(t){return t instanceof Error?t:new Error(t)}}},{}],20:[function(e,t,n){"use strict";var r=e("./array/map"),i=e("./object/map");t.exports=function(e,t,n){return e instanceof Array?r(e,t,n):i(e,t,n)}},{"./array/map":13,"./object/map":23}],21:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var i,o,s=Object.keys(e),a=s.length,u=void 0!==n?r(t,n):t;for(o=0;a>o;o++)i=s[o],u(e[i],i,e)}},{"../function/bindInternal3":18}],22:[function(e,t,n){"use strict";t.exports="function"==typeof Object.keys?Object.keys:function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],23:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var i,o,s=Object.keys(e),a=s.length,u={},c=void 0!==n?r(t,n):t;for(i=0;a>i;i++)o=s[i],u[o]=c(e[o],o,e);return u}},{"../function/bindInternal3":18}],24:[function(e,t,n){"use strict";var r=function(e,t,n,r,i,o,s,a){if(!e){var u;if(void 0===t)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,i,o,s,a],f=0;u=new Error(t.replace(/%s/g,function(){return c[f++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}};t.exports=r},{}],25:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var u=e("marsdb/dist/AsyncEventEmitter"),c=r(u),f=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?17500:arguments[0],n=arguments.length<=1||void 0===arguments[1]?1e4:arguments[1];i(this,t);var r=o(this,Object.getPrototypeOf(t).call(this));return r.pingTimeout=e,r.pongTimeout=n,r}return s(t,e),a(t,[{key:"waitPing",value:function(){var e=this;this._clearTimers(),this.waitPingTimer=setTimeout(function(){e.emit("sendPing"),e.waitPong()},this.pingTimeout)}},{key:"waitPong",value:function(){var e=this;this._clearTimers(),this.waitPongTimer=setTimeout(function(){return e.emit("timeout")},this.pongTimeout)}},{key:"handlePing",value:function(e){this._clearTimers(),this.emit("sendPong",e),this.waitPing()}},{key:"handlePong",value:function(){this._clearTimers(),this.waitPing()}},{key:"_clearTimers",value:function(){clearTimeout(this.waitPingTimer),clearTimeout(this.waitPongTimer)}}]),t}(c["default"]);n["default"]=f},{"marsdb/dist/AsyncEventEmitter":26}],26:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var u=e("eventemitter3"),c=r(u),f=function(e){function t(){return i(this,t),o(this,Object.getPrototypeOf(t).apply(this,arguments))}return s(t,e),a(t,[{key:"emitAsync",value:function(e,t,n,r,i,o){var s=c["default"].prefixed,a=s?s+e:e;if(!this._events||!this._events[a])return Promise.resolve();var u=void 0,f=this._events[a],l=arguments.length,h=void 0;if("function"==typeof f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),l){case 1:return Promise.resolve(f.fn.call(f.context));case 2:return Promise.resolve(f.fn.call(f.context,t));case 3:return Promise.resolve(f.fn.call(f.context,t,n));case 4:return Promise.resolve(f.fn.call(f.context,t,n,r));case 5:return Promise.resolve(f.fn.call(f.context,t,n,r,i));case 6:return Promise.resolve(f.fn.call(f.context,t,n,r,i,o))}for(u=1,h=new Array(l-1);l>u;u++)h[u-1]=arguments[u];return Promise.resolve(f.fn.apply(f.context,h))}var d=[],p=f.length,y=void 0;for(u=0;p>u;u++)switch(f[u].once&&this.removeListener(e,f[u].fn,void 0,!0),l){case 1:d.push(Promise.resolve(f[u].fn.call(f[u].context)));break;case 2:d.push(Promise.resolve(f[u].fn.call(f[u].context,t)));break;case 3:d.push(Promise.resolve(f[u].fn.call(f[u].context,t,n)));break;default:if(!h)for(y=1,h=new Array(l-1);l>y;y++)h[y-1]=arguments[y];d.push(Promise.resolve(f[u].fn.apply(f[u].context,h)))}return Promise.all(d)}}]),t}(c["default"]);n["default"]=f},{eventemitter3:11}],27:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var s=e("fast.js/function/try"),a=r(s),u=e("double-ended-queue"),c=r(u),f=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?1/0:arguments[0],n=arguments.length<=1||void 0===arguments[1]?1/0:arguments[1];i(this,e),this.pendingPromises=0,this.maxPendingPromises=t,this.maxQueuedPromises=n,this.queue=new c["default"],this.length=0}return o(e,[{key:"pause",value:function(){this._paused=!0}},{key:"unpause",value:function(){this._paused=!1,this._dequeue()}},{key:"add",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return new Promise(function(r,i){if(t.length>=t.maxQueuedPromises)i(new Error("Queue limit reached"));else{var o={promiseGenerator:e,resolve:r,reject:i};n?t.queue.unshift(o):t.queue.push(o),t.length+=1,t._dequeue()}})}},{key:"_dequeue",value:function(){var e=this;if(this._paused||this.pendingPromises>=this.maxPendingPromises)return!1;var t=this.queue.shift();if(!t)return!1;var n=(0,a["default"])(function(){return e.pendingPromises++,Promise.resolve().then(function(){return t.promiseGenerator()}).then(function(n){e.length--,e.pendingPromises--,t.resolve(n),e._dequeue()},function(n){e.length--,e.pendingPromises--,t.reject(n),e._dequeue()})});return n instanceof Error&&(this.length--,this.pendingPromises--,t.reject(n),this._dequeue()),!0}}]),e}();n["default"]=f},{"double-ended-queue":10,"fast.js/function/try":28}],28:[function(e,t,n){arguments[4][19][0].apply(n,arguments)},{dup:19}]},{},[9])(9)});