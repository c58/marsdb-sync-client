!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.Mars||(t.Mars={})).Meteor=e()}}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[a]={exports:{}};t[a][0].call(f.exports,function(e){var n=t[a][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){var t=_.defaultDelegate(),n=function(t){function n(){var t;i(this,n);for(var r=arguments.length,a=Array(r),s=0;r>s;s++)a[s]=arguments[s];var u=o(this,(t=Object.getPrototypeOf(n)).call.apply(t,[this].concat(a)));return e.on("status:connected",(0,d["default"])(u._handleConnected,u)),e.on("message:added",(0,d["default"])(u._handleRemoteAdded,u)),e.on("message:changed",(0,d["default"])(u._handleRemoteChanged,u)),e.on("message:removed",(0,d["default"])(u._handleRemoteRemoved,u)),u}return a(n,t),u(n,[{key:"insert",value:function(t){var r=this,i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=void 0;if(!i.quiet){var s="/"+this.db.modelName+"/insert",u=function(e){return a.then(function(){return r.db.remove(t._id,{quiet:!0})}).then(function(){throw e})},f=e.methodManager.apply(s,[t,i],o.seed).then(null,u);if(i.waitResult)return f}return a=c(Object.getPrototypeOf(n.prototype),"insert",this).call(this,t,i,o)}},{key:"remove",value:function(t){var r=this,i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=void 0;if(!i.quiet){var a="/"+this.db.modelName+"/remove",s=function(e){return o.then(function(e){return r.db.insertAll(e,{quiet:!0})}).then(function(){throw e})},u=e.methodManager.apply(a,[t,i]).then(null,s);if(i.waitResult)return u}return o=c(Object.getPrototypeOf(n.prototype),"remove",this).call(this,t,i)}},{key:"update",value:function(t,r){var i=this,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=void 0;if(!o.quiet){var s="/"+this.db.modelName+"/update",u=function(e){return a.then(function(e){(0,h["default"])(e.updated,function(t,n){if(e.original[n]){var r=e.original[n]._id;delete e.original[n]._id,i.db.update({_id:r},e.original[n],{quiet:!0,upsert:!0})}else i.db.remove(t._id,{quiet:!0})})}).then(function(){throw e})},f=e.methodManager.apply(s,[t,r,o]).then(null,u);if(o.waitResult)return f}return a=c(Object.getPrototypeOf(n.prototype),"update",this).call(this,t,r,o)}},{key:"_handleRemoteAdded",value:function(e){return delete e.fields._id,this.db.update({_id:e.id},e.fields,{quiet:!0,upsert:!0})}},{key:"_handleRemoteChanged",value:function(e){var t={};if(Array.isArray(e.cleared)&&e.cleared.length>0){t.$unset={};var n=!0,r=!1,i=void 0;try{for(var o,a=e.cleared[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;t.$unset[s]=1}}catch(u){r=!0,i=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw i}}}return e.fields&&(delete e.fields._id,t.$set={},(0,h["default"])(e.fields,function(e,n){t.$set[n]=e})),(0,y["default"])(t).length>0?this.db.update(e.id,t,{quiet:!0}):void 0}},{key:"_handleRemoteRemoved",value:function(e){return this.db.remove(e.id,{quiet:!0})}},{key:"_handleConnected",value:function(t){var n=this,r="/"+this.db.modelName+"/sync";return this.db.ids().then(function(t){return e.methodManager.apply(r,[t]).result()}).then(function(e){return n.db.remove({_id:{$in:e}},{quiet:!0,multi:!0})})}}]),n}(t);return n}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function v(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:v(i,t,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)};Object.defineProperty(n,"__esModule",{value:!0}),n.createCollectionDelegate=s;var f=e("fast.js/function/bind"),d=r(f),l=e("fast.js/forEach"),h=r(l),p=e("fast.js/object/keys"),y=r(p),_="undefined"!=typeof window&&window.Mars?window.Mars.Collection:e("marsdb").Collection},{"fast.js/forEach":14,"fast.js/function/bind":17,"fast.js/object/keys":22,marsdb:void 0}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e,t){var n=!1;return"function"==typeof e?n=e(t):(Array.isArray(t)&&t.length>0||"[object Object]"===Object.prototype.toString.call(t)&&(0,h["default"])(t).length>0)&&(n=!0),n}function c(e){var t=p.defaultCursor(),n=function(t){function n(){return o(this,n),a(this,Object.getPrototypeOf(n).apply(this,arguments))}return s(n,t),f(n,[{key:"_doUpdate",value:function(t){var r=this,o=this.options,a=o.sub,s=o.waitReady,c=o.tryCache,f=function(){return d(Object.getPrototypeOf(n.prototype),"_doUpdate",r).call(r,t)};if(!this._subscription&&a){var l;if(this._subscription=(l=e.subManager).subscribe.apply(l,i(a)),this.once("observeStopped",function(){r._subscription.stop(),delete r._subscription}),s)return this._subscription.ready().then(f);if(c)return this.exec().then(function(e){return u(c,e)?(r._updateLatestIds(),r._propagateUpdate(t).then(function(){return e})):r._subscription.ready().then(f)})}return f()}}]),n}(t);return n}var f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=function y(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:y(i,t,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)};Object.defineProperty(n,"__esModule",{value:!0}),n._isCacheValid=u,n.createCursorWithSub=c;var l=e("fast.js/object/keys"),h=r(l),p="undefined"!=typeof window&&window.Mars?window.Mars.Collection:e("marsdb").Collection},{"fast.js/object/keys":22,marsdb:void 0}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.CONN_STATUS=void 0;var u=e("fast.js/function/try"),c=r(u),f=e("fast.js/function/bind"),d=r(f),l=e("./HeartbeatManager"),h=r(l),p="undefined"!=typeof window&&window.Mars?window.Mars.EventEmitter:e("marsdb").EventEmitter,y="undefined"!=typeof window&&window.Mars?window.Mars.PromiseQueue:e("marsdb").PromiseQueue,_="undefined"!=typeof window&&window.Mars?window.Mars.EJSON:e("marsdb").EJSON,v="undefined"!=typeof window&&window.Mars?window.Mars.Random:e("marsdb").Random,m=1,b=17500,g=15e3,w=5e3,E=n.CONN_STATUS={CONNECTING:"CONNECTING",CONNECTED:"CONNECTED",DISCONNECTED:"DISCONNECTED"},O=function(e){function t(e){var n=e.url,r=e.socket,a=void 0===r?WebSocket:r,s=e.autoReconnect,u=void 0===s?!0:s;i(this,t);var c=o(this,Object.getPrototypeOf(t).call(this));return c.url=n,c._processQueue=new y(1),c._sessionId=null,c._autoReconnect=u,c._socket=a,c._status=E.DISCONNECTED,c._heartbeat=new h["default"](b,g),c._heartbeat.on("timeout",(0,d["default"])(c._handleHearbeatTimeout,c)),c._heartbeat.on("sendPing",(0,d["default"])(c.sendPing,c)),c._heartbeat.on("sendPong",(0,d["default"])(c.sendPong,c)),c.connect(),c}return a(t,e),s(t,[{key:"sendMethod",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],n=arguments[2],r=arguments[3],i={msg:"method",id:n,method:e,params:t};r&&(i.randomSeed=r),this._sendMessage(i)}},{key:"sendSub",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],n=arguments[2];this._sendMessage({msg:"sub",id:n,name:e,params:t})}},{key:"sendUnsub",value:function(e){this._sendMessage({msg:"unsub",id:e})}},{key:"sendPing",value:function(){this._sendMessage({msg:"ping",id:v["default"]().id(20)})}},{key:"sendPong",value:function(e){this._sendMessage({msg:"pong",id:e})}},{key:"connect",value:function(){return this.isDisconnected?(this._rawConn=new this._socket(this.url),this._rawConn.onopen=(0,d["default"])(this._handleOpen,this),this._rawConn.onerror=(0,d["default"])(this._handleError,this),this._rawConn.onclose=(0,d["default"])(this._handleClose,this),this._rawConn.onmessage=(0,d["default"])(this._handleRawMessage,this),this._setStatus(E.CONNECTING),!0):!1}},{key:"reconnect",value:function(){var e=this;return this.isDisconnected?(clearTimeout(this._reconnTimer),this._reconnecting=!0,this._reconnTimer=setTimeout((0,d["default"])(this.connect,this),w),function(){clearTimeout(e._reconnTimer),e._reconnecting=!1,e.disconnect()}):void 0}},{key:"disconnect",value:function(){var e=this;(0,c["default"])(function(){return e._rawConn&&e._rawConn.close()})}},{key:"_handleOpen",value:function(){this._heartbeat.waitPing(),this._sendMessage({msg:"connect",session:this._sessionId,version:m,support:[m]})}},{key:"_handleConnectedMessage",value:function(e){this.isConnected||(this._setStatus(E.CONNECTED,this._reconnecting),this._sessionId=e.session,this._reconnecting=!1)}},{key:"_handleClose",value:function(){this._heartbeat._clearTimers(),this._setStatus(E.DISCONNECTED),this._autoReconnect&&(this._reconnecting=!1,this.reconnect())}},{key:"_handleHearbeatTimeout",value:function(){this.disconnect()}},{key:"_handleError",value:function(e){this.emit("error",e)}},{key:"_handleRawMessage",value:function(e){var t=this;return this._processQueue.add(function(){var n=_.parse(e.data);return t._processMessage(n)}).then(null,function(e){t._handleError(e)})}},{key:"_processMessage",value:function(e){switch(e.msg){case"connected":return this._handleConnectedMessage(e);case"ping":return this._heartbeat.handlePing(e);case"pong":return this._heartbeat.handlePong(e);case"removed":case"changed":case"added":case"updated":case"result":case"nosub":case"ready":case"error":return this.emitAsync("message:"+e.msg,e);default:throw new Error("Unknown message type "+e.msg)}}},{key:"_sendMessage",value:function(e){var t=this,n=(0,c["default"])(function(){return t._rawConn.send(_.stringify(e))});n instanceof Error&&this._handleError(n)}},{key:"_setStatus",value:function(e,t){this._status=e,this.emit(("status:"+e).toLowerCase(),t)}},{key:"isConnected",get:function(){return this._status===E.CONNECTED}},{key:"isDisconnected",get:function(){return this._status===E.DISCONNECTED}}]),t}(p);n["default"]=O},{"./HeartbeatManager":5,"fast.js/function/bind":17,"fast.js/function/try":19,marsdb:void 0}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("fast.js/function/bind"),s=r(a),u=function(){function e(t){i(this,e),this.conn=t,t.on("message:error",(0,s["default"])(this._handleError,this)),t.on("error",(0,s["default"])(this._handleError,this))}return o(e,[{key:"_handleError",value:function(e){e&&e.message?console.warn(e.message+"\n"+e.stack):console.warn(JSON.stringify(e))}}]),e}();n["default"]=u},{"fast.js/function/bind":17}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var s="undefined"!=typeof window&&window.Mars?window.Mars.EventEmitter:e("marsdb").EventEmitter,u=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?17500:arguments[0],n=arguments.length<=1||void 0===arguments[1]?1e4:arguments[1];r(this,t);var o=i(this,Object.getPrototypeOf(t).call(this));return o.pingTimeout=e,o.pongTimeout=n,o}return o(t,e),a(t,[{key:"waitPing",value:function(){var e=this;this._clearTimers(),this.waitPingTimer=setTimeout(function(){e.emit("sendPing"),e.waitPong()},this.pingTimeout)}},{key:"waitPong",value:function(){var e=this;this._clearTimers(),this.waitPongTimer=setTimeout(function(){return e.emit("timeout")},this.pongTimeout)}},{key:"handlePing",value:function(e){this._clearTimers(),this.emit("sendPong",e),this.waitPing()}},{key:"handlePong",value:function(){this._clearTimers(),this.waitPing()}},{key:"_clearTimers",value:function(){clearTimeout(this.waitPingTimer),clearTimeout(this.waitPongTimer)}}]),t}(s);n["default"]=u},{marsdb:void 0}],6:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var s="undefined"!=typeof window&&window.Mars?window.Mars.EventEmitter:e("marsdb").EventEmitter,u="undefined"!=typeof window&&window.Mars?window.Mars.Random:e("marsdb").Random,c=n.CALL_STATUS={PENDING:"PENDING",SENT:"SENT",RESULT:"RESULT",ERROR:"ERROR",UPDATED:"UPDATED"},f=function(e){function t(e,n,o,a){r(this,t);var s=i(this,Object.getPrototypeOf(t).call(this));return s.result=function(){return s._promiseMixed(new Promise(function(e,t){s._error?t(s._error):s._result?e(s._result):(s.once(c.RESULT,e),s.once(c.ERROR,t))}))},s.updated=function(){return s._promiseMixed(new Promise(function(e,t){s._updated?e():s.once(c.UPDATED,e)}))},s.id=u["default"]().id(20),s.status=c.PENDING,s.method=e,s.params=n,s.randomSeed=o,s._conn=a,s}return o(t,e),a(t,[{key:"then",value:function(e,t){var n=this;return this.updated().then(function(){return n.result().then(e,t)},t)}},{key:"_invoke",value:function(){this._conn.sendMethod(this.method,this.params,this.id,this.randomSeed),this._setStatus(c.SENT)}},{key:"_promiseMixed",value:function(e){var t=this;return{result:this.result,updated:this.updated,then:function(){return t._promiseMixed(e.then.apply(e,arguments))}}}},{key:"_handleResult",value:function(e,t){e?(this._error=e,this._setStatus(c.ERROR,e)):(this._result=t,this._setStatus(c.RESULT,t))}},{key:"_handleUpdated",value:function(e){this._updated=!0,this._setStatus(c.UPDATED)}},{key:"_setStatus",value:function(e,t,n,r,i){this.status=e,this.emit(e,t,n,r,i)}},{key:"isPending",get:function(){return this.status===c.PENDING}},{key:"isSent",get:function(){return this.status===c.SENT}},{key:"isDone",get:function(){return this.status!==c.SENT&&this.status!==c.PENDING}}]),t}(s);n["default"]=f},{marsdb:void 0}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("fast.js/function/bind"),s=r(a),u=e("fast.js/forEach"),c=r(u),f=e("./MethodCall"),d=r(f),l=function(){function e(t){i(this,e),this.conn=t,this._methods={},t.on("status:disconnected",(0,s["default"])(this._handleDisconnected,this)),t.on("status:connected",(0,s["default"])(this._handleConnected,this)),t.on("message:result",(0,s["default"])(this._handleMethodResult,this)),t.on("message:updated",(0,s["default"])(this._handleMethodUpdated,this))}return o(e,[{key:"call",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return this.apply(e,n)}},{key:"apply",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],r=arguments[2],i=new d["default"](e,n,r,this.conn);this._methods[i.id]=i;var o=function(){return delete t._methods[i.id]};return i.then(o,o),this.conn.isConnected&&i._invoke(),i}},{key:"_handleMethodResult",value:function(e){if(e.id&&this._methods[e.id]){var t=e.result,n=e.error;this._methods[e.id]._handleResult(n,t)}}},{key:"_handleMethodUpdated",value:function(e){var t=this;(0,c["default"])(e.methods,function(e){t._methods[e]&&t._methods[e]._handleUpdated()})}},{key:"_handleDisconnected",value:function(){(0,c["default"])(this._methods,function(e){e.isPending||e._handleResult({reason:"Disconnected, method can't be done"})})}},{key:"_handleConnected",value:function(){(0,c["default"])(this._methods,function(e){e.isPending&&e._invoke()})}}]),e}();n["default"]=l},{"./MethodCall":6,"fast.js/forEach":14,"fast.js/function/bind":17}],8:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var s="undefined"!=typeof window&&window.Mars?window.Mars.EventEmitter:e("marsdb").EventEmitter,u="undefined"!=typeof window&&window.Mars?window.Mars.Random:e("marsdb").Random,c=n.SUB_STATUS={READY_PENDING:"READY_PENDING",READY:"READY",ERROR:"ERROR",STOP_PENDING:"STOP_PENDING",STOPPED:"STOPPED",FROZEN:"FROZEN"},f=function(e){function t(e,n,o){var a=arguments.length<=3||void 0===arguments[3]?15e3:arguments[3];r(this,t);var s=i(this,Object.getPrototypeOf(t).call(this));return s.ready=function(){return s._promiseMixed(new Promise(function(e,t){s.isReady?e():(s.once(c.READY,e),s.once(c.ERROR,t))}))},s.stopped=function(){return s._promiseMixed(new Promise(function(e,t){s.isStopped?e():(s.once(c.STOPPED,e),s.once(c.ERROR,t))}))},s.stop=function(){s._scheduleStop()},s.id=u["default"]().id(20),s.name=e,s.params=n,s._conn=o,s._ready=!1,s._stopWaitTimeout=a,s}return o(t,e),a(t,[{key:"then",value:function(e,t){return this.ready().then(e,t)}},{key:"_promiseMixed",value:function(e){var t=this;return{stopped:this.stopped,ready:this.ready,stop:this.stop,then:function(){return t._promiseMixed(e.then.apply(e,arguments))}}}},{key:"_subscribe",value:function(){this.status&&this.status!==c.STOP_PENDING&&this.status!==c.STOPPED&&this.status!==c.ERROR&&this.status!==c.FROZEN||(this.status===c.STOP_PENDING?this._ready?(this._clearStopper(),this._setStatus(c.READY)):this._setStatus(c.READY_PENDING):(this._setStatus(c.READY_PENDING),this._conn.sendSub(this.name,this.params,this.id)))}},{key:"_scheduleStop",value:function(){var e=this;this.status!==c.STOP_PENDING&&this.status!==c.STOPPED&&(this._setStatus(c.STOP_PENDING),this._stopTimer=setTimeout(function(){return e._stopImmediately()},this._stopWaitTimeout))}},{key:"_stopImmediately",value:function(e){this.status!==c.STOPPED&&(this._clearStopper(),this._setStatus(c.STOPPED),this._ready=!1,e&&e.dontSendMsg||this._conn.sendUnsub(this.id))}},{key:"_freeze",value:function(){this.status===c.STOP_PENDING?this._stopImmediately({dontSendMsg:!0}):this.status&&this.status===c.STOPPED||this._setStatus(c.FROZEN)}},{key:"_setStatus",value:function(e,t,n,r,i){this.status=e,this.emit(e,t,n,r,i)}},{key:"_clearStopper",value:function(){clearTimeout(this._stopTimer),this._stopTimer=null}},{key:"_handleNosub",value:function(e){this._clearStopper(),e?this._setStatus(c.ERROR,e):this._stopImmediately({dontSendMsg:!0})}},{key:"_handleReady",value:function(){this.status!==c.STOPPED&&this.status!==c.STOP_PENDING&&(this._ready=!0,this._setStatus(c.READY))}},{key:"isReady",get:function(){return this.status==c.READY||this.status===c.FROZEN&&this._ready}},{key:"isReadyPending",get:function(){return this.status===c.READY_PENDING}},{key:"isStopped",get:function(){return this.status===c.STOPPED}},{key:"isStopPending",get:function(){return this.status===c.STOP_PENDING}},{key:"isFaulted",get:function(){return this.status===c.ERROR}},{key:"isFrozen",get:function(){return this.status==c.FROZEN}}]),t}(s);n["default"]=f},{marsdb:void 0}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var u=e("fast.js/function/bind"),c=r(u),f=e("fast.js/forEach"),d=r(f),l=e("./Subscription"),h=r(l),p="undefined"!=typeof window&&window.Mars?window.Mars.EventEmitter:e("marsdb").EventEmitter,y=15e3,_=function(e){function t(e){i(this,t);var n=o(this,Object.getPrototypeOf(t).call(this));return n._subs={},n._loading=new Set,n._conn=e,e.on("status:connected",(0,c["default"])(n._handleConnected,n)),e.on("status:disconnected",(0,c["default"])(n._handleDisconnected,n)),e.on("message:ready",(0,c["default"])(n._handleSubscriptionReady,n)),e.on("message:nosub",(0,c["default"])(n._handleSubscriptionNosub,n)),n}return a(t,e),s(t,[{key:"subscribe",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),i=1;n>i;i++)r[i-1]=arguments[i];var o=new h["default"](e,r,this._conn,y);this._subs[o.id]=o,this._trackLoadingStart(o.id);var a=function(){delete t._subs[o.id],t._trackLoadingReady(o.id)};return o.once(l.SUB_STATUS.STOPPED,a),o.once(l.SUB_STATUS.ERROR,a),this._conn.isConnected?o._subscribe():o._freeze(),o}},{key:"addReadyListener",value:function(e){var t=this;return this.on("ready",e),function(){return t.removeListener("ready",e)}}},{key:"addLoadingListener",value:function(e){var t=this;return this.on("loading",e),function(){return t.removeListener("loading",e)}}},{key:"_handleConnected",value:function(){(0,d["default"])(this._subs,function(e){return e._subscribe()})}},{key:"_handleDisconnected",value:function(){var e=this;(0,d["default"])(this._subs,function(t,n){t._freeze(),t.isFrozen?e._trackLoadingStart(n):e._trackLoadingReady(n)})}},{key:"_handleSubscriptionReady",value:function(e){var t=this;(0,d["default"])(e.subs,function(e){var n=t._subs[e];n&&(n._handleReady(),t._trackLoadingReady(e))})}},{key:"_handleSubscriptionNosub",value:function(e){var t=this._subs[e.id];t&&t._handleNosub(e.error)}},{key:"_trackLoadingStart",value:function(e){var t=this._loading.size;this._loading.add(e),0===t&&this._loading.size>0&&this.emit("loading")}},{key:"_trackLoadingReady",value:function(e){var t=this._loading.size;this._loading["delete"](e),t>0&&0===this._loading.size&&this.emit("ready")}}]),t}(p);n["default"]=_},{"./Subscription":8,"fast.js/forEach":14,"fast.js/function/bind":17,marsdb:void 0}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(){return P}function o(){var e;return(e=P.methodManager).call.apply(e,arguments)}function a(){var e;return(e=P.methodManager).apply.apply(e,arguments)}function s(){var e;return(e=P.subManager).subscribe.apply(e,arguments)}function u(e){var t=e.url,n=e.managers,r=void 0===n?[]:n,i=e.socket,o=void 0===i?WebSocket:i;return(0,l["default"])(!P,"configure(...): connection already configured"),P=new p["default"]({url:t,socket:o}),P.customManagers=(0,f["default"])(r,function(e){return new e(P)}),P.subManager=new _["default"](P),P.methodManager=new m["default"](P),P.errorManager=new g["default"](P),O.defaultDelegate((0,w.createCollectionDelegate)(P)),O.defaultCursor((0,E.createCursorWithSub)(P)),P}Object.defineProperty(n,"__esModule",{value:!0}),n.getConnection=i,n.call=o,n.apply=a,n.subscribe=s,n.configure=u;var c=e("fast.js/map"),f=r(c),d=e("invariant"),l=r(d),h=e("./DDPConnection"),p=r(h),y=e("./SubscriptionManager"),_=r(y),v=e("./MethodCallManager"),m=r(v),b=e("./ErrorManager"),g=r(b),w=e("./CollectionManager"),E=e("./CursorWithSub"),O="undefined"!=typeof window&&window.Mars?window.Mars.Collection:e("marsdb").Collection,P=null},{"./CollectionManager":1,"./CursorWithSub":2,"./DDPConnection":3,"./ErrorManager":4,"./MethodCallManager":7,"./SubscriptionManager":9,"fast.js/map":20,invariant:24,marsdb:void 0}],11:[function(e,t,n){const r=e("./dist");t.exports={configure:r.configure,apply:r.apply,call:r.call,subscribe:r.subscribe}},{"./dist":10}],12:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var i,o=e.length,a=void 0!==n?r(t,n):t;for(i=0;o>i;i++)a(e[i],i,e)}},{"../function/bindInternal3":18}],13:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var i,o=e.length,a=new Array(o),s=void 0!==n?r(t,n):t;for(i=0;o>i;i++)a[i]=s(e[i],i,e);return a}},{"../function/bindInternal3":18}],14:[function(e,t,n){"use strict";var r=e("./array/forEach"),i=e("./object/forEach");t.exports=function(e,t,n){return e instanceof Array?r(e,t,n):i(e,t,n)}},{"./array/forEach":12,"./object/forEach":21}],15:[function(e,t,n){"use strict";t.exports=function(e,t){switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);case 4:return e(t[0],t[1],t[2],t[3]);case 5:return e(t[0],t[1],t[2],t[3],t[4]);case 6:return e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return e(t[0],t[1],t[2],t[3],t[4],t[5],t[6]);case 8:return e(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]);default:return e.apply(void 0,t)}}},{}],16:[function(e,t,n){"use strict";t.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2]);case 4:return e.call(t,n[0],n[1],n[2],n[3]);case 5:return e.call(t,n[0],n[1],n[2],n[3],n[4]);case 6:return e.call(t,n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return e.call(t,n[0],n[1],n[2],n[3],n[4],n[5],n[6]);case 8:return e.call(t,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);default:return e.apply(t,n)}}},{}],17:[function(e,t,n){"use strict";var r=e("./applyWithContext"),i=e("./applyNoContext");t.exports=function(e,t){var n,o=arguments.length-2;if(o>0){n=new Array(o);for(var a=0;o>a;a++)n[a]=arguments[a+2];return void 0!==t?function(){var i,a=arguments.length,s=new Array(o+a);for(i=0;o>i;i++)s[i]=n[i];for(i=0;a>i;i++)s[o+i]=arguments[i];return r(e,t,s)}:function(){var t,r=arguments.length,a=new Array(o+r);for(t=0;o>t;t++)a[t]=n[t];for(t=0;r>t;t++)a[o+t]=arguments[t];return i(e,a)}}return void 0!==t?function(){return r(e,t,arguments)}:function(){return i(e,arguments)}}},{"./applyNoContext":15,"./applyWithContext":16}],18:[function(e,t,n){"use strict";t.exports=function(e,t){return function(n,r,i){return e.call(t,n,r,i)}}},{}],19:[function(e,t,n){"use strict";t.exports=function(e){try{return e()}catch(t){return t instanceof Error?t:new Error(t)}}},{}],20:[function(e,t,n){"use strict";var r=e("./array/map"),i=e("./object/map");t.exports=function(e,t,n){return e instanceof Array?r(e,t,n):i(e,t,n)}},{"./array/map":13,"./object/map":23}],21:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var i,o,a=Object.keys(e),s=a.length,u=void 0!==n?r(t,n):t;for(o=0;s>o;o++)i=a[o],u(e[i],i,e)}},{"../function/bindInternal3":18}],22:[function(e,t,n){"use strict";t.exports="function"==typeof Object.keys?Object.keys:function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);
return t}},{}],23:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var i,o,a=Object.keys(e),s=a.length,u={},c=void 0!==n?r(t,n):t;for(i=0;s>i;i++)o=a[i],u[o]=c(e[o],o,e);return u}},{"../function/bindInternal3":18}],24:[function(e,t,n){"use strict";var r=function(e,t,n,r,i,o,a,s){if(!e){var u;if(void 0===t)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,i,o,a,s],f=0;u=new Error(t.replace(/%s/g,function(){return c[f++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}};t.exports=r},{}]},{},[11])(11)});